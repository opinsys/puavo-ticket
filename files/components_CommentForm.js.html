<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>components/CommentForm.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Backbone.Collection.html">Backbone.Collection</a></li>
            
                <li><a href="../classes/Backbone.Events.html">Backbone.Events</a></li>
            
                <li><a href="../classes/Backbone.Model.html">Backbone.Model</a></li>
            
                <li><a href="../classes/Bluebird.Promise.html">Bluebird.Promise</a></li>
            
                <li><a href="../classes/Bookshelf.Collection.html">Bookshelf.Collection</a></li>
            
                <li><a href="../classes/Bookshelf.Model.html">Bookshelf.Model</a></li>
            
                <li><a href="../classes/components.AttachmentsForm.html">components.AttachmentsForm</a></li>
            
                <li><a href="../classes/components.CommentForm.html">components.CommentForm</a></li>
            
                <li><a href="../classes/components.EditableText.html">components.EditableText</a></li>
            
                <li><a href="../classes/components.ElasticTextarea.html">components.ElasticTextarea</a></li>
            
                <li><a href="../classes/components.ErrorMessage.html">components.ErrorMessage</a></li>
            
                <li><a href="../classes/components.FileItem.html">components.FileItem</a></li>
            
                <li><a href="../classes/components.ForcedLinebreaks.html">components.ForcedLinebreaks</a></li>
            
                <li><a href="../classes/components.Loading.html">components.Loading</a></li>
            
                <li><a href="../classes/components.Loading.Spinner.html">components.Loading.Spinner</a></li>
            
                <li><a href="../classes/components.Main.html">components.Main</a></li>
            
                <li><a href="../classes/components.NotificationBox.html">components.NotificationBox</a></li>
            
                <li><a href="../classes/components.NotificationsHub.html">components.NotificationsHub</a></li>
            
                <li><a href="../classes/components.NotificationsHub.NotificationItem.html">components.NotificationsHub.NotificationItem</a></li>
            
                <li><a href="../classes/components.OnViewportMixin.html">components.OnViewportMixin</a></li>
            
                <li><a href="../classes/components.ProfileBadge.html">components.ProfileBadge</a></li>
            
                <li><a href="../classes/components.Redacted.html">components.Redacted</a></li>
            
                <li><a href="../classes/components.SelectUsers.html">components.SelectUsers</a></li>
            
                <li><a href="../classes/components.SelectUsers.UserItem.html">components.SelectUsers.UserItem</a></li>
            
                <li><a href="../classes/components.SideInfo.html">components.SideInfo</a></li>
            
                <li><a href="../classes/components.StringDiff.html">components.StringDiff</a></li>
            
                <li><a href="../classes/components.TicketForm.html">components.TicketForm</a></li>
            
                <li><a href="../classes/components.TicketList.html">components.TicketList</a></li>
            
                <li><a href="../classes/components.TicketList.TitleList.html">components.TicketList.TitleList</a></li>
            
                <li><a href="../classes/components.TicketView.html">components.TicketView</a></li>
            
                <li><a href="../classes/components.TicketView.CommentUpdate.html">components.TicketView.CommentUpdate</a></li>
            
                <li><a href="../classes/components.TicketView.HandlerUpdate.html">components.TicketView.HandlerUpdate</a></li>
            
                <li><a href="../classes/components.TicketView.TagUpdate.html">components.TicketView.TagUpdate</a></li>
            
                <li><a href="../classes/components.TicketView.TitleUpdate.html">components.TicketView.TitleUpdate</a></li>
            
                <li><a href="../classes/components.TicketView.ToggleFollowButton.html">components.TicketView.ToggleFollowButton</a></li>
            
                <li><a href="../classes/components.TicketView.ToggleStatusButton.html">components.TicketView.ToggleStatusButton</a></li>
            
                <li><a href="../classes/components.TicketView.UpdateMixin.html">components.TicketView.UpdateMixin</a></li>
            
                <li><a href="../classes/components.TimeAgo.html">components.TimeAgo</a></li>
            
                <li><a href="../classes/components.UploadProgress.html">components.UploadProgress</a></li>
            
                <li><a href="../classes/components.User.html">components.User</a></li>
            
                <li><a href="../classes/models.BaseMixin.html">models.BaseMixin</a></li>
            
                <li><a href="../classes/models.client.Base.html">models.client.Base</a></li>
            
                <li><a href="../classes/models.client.Base.Collection.html">models.client.Base.Collection</a></li>
            
                <li><a href="../classes/models.client.Base.NotFound.html">models.client.Base.NotFound</a></li>
            
                <li><a href="../classes/models.client.Comment.html">models.client.Comment</a></li>
            
                <li><a href="../classes/models.client.Device.html">models.client.Device</a></li>
            
                <li><a href="../classes/models.client.Handler.html">models.client.Handler</a></li>
            
                <li><a href="../classes/models.client.models.UserMixin.html">models.client.models.UserMixin</a></li>
            
                <li><a href="../classes/models.client.Notification.html">models.client.Notification</a></li>
            
                <li><a href="../classes/models.client.Tag.html">models.client.Tag</a></li>
            
                <li><a href="../classes/models.client.Ticket.html">models.client.Ticket</a></li>
            
                <li><a href="../classes/models.client.Ticket.Collection.html">models.client.Ticket.Collection</a></li>
            
                <li><a href="../classes/models.client.TicketView.opinsysRobot.html">models.client.TicketView.opinsysRobot</a></li>
            
                <li><a href="../classes/models.client.Title.html">models.client.Title</a></li>
            
                <li><a href="../classes/models.client.UpdatesCollection.html">models.client.UpdatesCollection</a></li>
            
                <li><a href="../classes/models.server.Attachment.html">models.server.Attachment</a></li>
            
                <li><a href="../classes/models.server.Base.html">models.server.Base</a></li>
            
                <li><a href="../classes/models.server.Chunk.html">models.server.Chunk</a></li>
            
                <li><a href="../classes/models.server.Comment.html">models.server.Comment</a></li>
            
                <li><a href="../classes/models.server.Device.html">models.server.Device</a></li>
            
                <li><a href="../classes/models.server.Email.html">models.server.Email</a></li>
            
                <li><a href="../classes/models.server.Follower.html">models.server.Follower</a></li>
            
                <li><a href="../classes/models.server.Handler.html">models.server.Handler</a></li>
            
                <li><a href="../classes/models.server.Notification.html">models.server.Notification</a></li>
            
                <li><a href="../classes/models.server.Tag.html">models.server.Tag</a></li>
            
                <li><a href="../classes/models.server.Ticket.html">models.server.Ticket</a></li>
            
                <li><a href="../classes/models.server.Ticket.queries.html">models.server.Ticket.queries</a></li>
            
                <li><a href="../classes/models.server.Title.html">models.server.Title</a></li>
            
                <li><a href="../classes/models.server.User.html">models.server.User</a></li>
            
                <li><a href="../classes/models.TagMixin.html">models.TagMixin</a></li>
            
                <li><a href="../classes/models.TicketMixin.html">models.TicketMixin</a></li>
            
                <li><a href="../classes/models.UserInformation.html">models.UserInformation</a></li>
            
                <li><a href="../classes/React.ReactComponent.html">React.ReactComponent</a></li>
            
                <li><a href="../classes/ReactComponent.html">ReactComponent</a></li>
            
                <li><a href="../classes/ReactCompositeComponent.html">ReactCompositeComponent</a></li>
            
                <li><a href="../classes/ReactMountReady.html">ReactMountReady</a></li>
            
                <li><a href="../classes/ReactMultiChild.html">ReactMultiChild</a></li>
            
                <li><a href="../classes/ReactOwner.html">ReactOwner</a></li>
            
                <li><a href="../classes/ReactPropTransferer.html">ReactPropTransferer</a></li>
            
                <li><a href="../classes/ReactReconcileTransaction.html">ReactReconcileTransaction</a></li>
            
                <li><a href="../classes/ReactServerRenderingTransaction.html">ReactServerRenderingTransaction</a></li>
            
                <li><a href="../classes/ReactTestUtils.html">ReactTestUtils</a></li>
            
                <li><a href="../classes/ReactTextComponent.html">ReactTextComponent</a></li>
            
                <li><a href="../classes/server.Request.html">server.Request</a></li>
            
                <li><a href="../classes/server.Response.html">server.Response</a></li>
            
                <li><a href="../classes/test.helpers.html">test.helpers</a></li>
            
                <li><a href="../classes/utils.BrowserTitle.html">utils.BrowserTitle</a></li>
            
                <li><a href="../classes/utils.GridSQL.html">utils.GridSQL</a></li>
            
                <li><a href="../classes/utils.middleware.createResponseLogger.html">utils.middleware.createResponseLogger</a></li>
            
                <li><a href="../classes/utils.middleware.createSlowInternet.html">utils.middleware.createSlowInternet</a></li>
            
                <li><a href="../classes/utils.Puavo.html">utils.Puavo</a></li>
            
                <li><a href="../classes/utils.Superagent.html">utils.Superagent</a></li>
            
                <li><a href="../classes/utils.Transaction.html">utils.Transaction</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/filesize.html">filesize</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected" checked>
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private" checked>
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated" checked>
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: components/CommentForm.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/** @jsx React.DOM */
&quot;use strict&quot;;

var React = require(&quot;react/addons&quot;);
var $ = require(&quot;jquery&quot;);
var _ = require(&quot;lodash&quot;);

var ElasticTextarea = require(&quot;./ElasticTextarea&quot;);

var Button = require(&quot;react-bootstrap/Button&quot;);
var OverlayTrigger = require(&quot;react-bootstrap/OverlayTrigger&quot;);
var Tooltip = require(&quot;react-bootstrap/Tooltip&quot;);
var Label = require(&quot;react-bootstrap/Label&quot;);

function scrollElBottom(el, padding) {
    padding = padding || 0;
    var $el = $(el);
    window.scrollTo(0, $el.offset().top - $(window).height() + $el.height() + padding);
}


// http://stackoverflow.com/a/488073/153718
function isScrolledIntoView(elem, padding) {
    padding = padding || 0;
    var docViewTop = $(window).scrollTop();
    var docViewBottom = docViewTop + $(window).height();

    var elemTop = $(elem).offset().top;
    var elemBottom = elemTop + $(elem).height() + padding;

    return ((elemBottom &lt;= docViewBottom) &amp;&amp; (elemTop &gt;= docViewTop));
}


/**
 * Two mode comment form
 *
 * When single line mode
 *
 *   - Enter key submits the value
 *   - Shift+Enter forces a line break and enables the multiline mode
 *
 * When in multiline mode:
 *
 *   - Enter key adds an additional line break
 *   - Ctrl+Enter submits the value
 *
 * @namespace components
 * @class CommentForm
 * @constructor
 * @param {Object} props
 * @param {Function} [props.onSubmit] Called when the form is submitted with
 * the button or the keyboard shortcut
 */
var CommentForm = React.createClass({

    propTypes: {
        onSubmit: React.PropTypes.func
    },

    getDefaultProps: function() {
        return {
            onSubmit: function(){}
        };
    },

    getInitialState: function() {
        return {
            comment: &quot;&quot;
        };
    },

    componentDidMount: function() {
        this.scrollToCommentButton = _.throttle(this.scrollToCommentButton, 100);
    },

    isMultilineMode: function() {
        return this.state.comment.split(&quot;\n&quot;).length &gt; 1;
    },

    /**
     * Return true if the textarea has a proper comment
     *
     * @method hasComment
     * @return {Boolean}
     */
    hasComment: function() {
        return !!this.state.comment.trim();
    },

    _handleKeyDown: function(e) {
        if (e.key !== &quot;Enter&quot;) return;

        // Ctrl+Enter always saves the comment
        if (e.ctrlKey) {
            e.preventDefault();
            this._submit();
            return;
        }

        // Shift+Enter or plain enter in multiline mode inserts a line break
        if (e.shiftKey || this.isMultilineMode()) return;

        e.preventDefault();
        this._submit();
    },


    /**
     * Clear the textarea
     *
     * @method clear
     */
    clear: function() {
        this.setState({ comment: &quot;&quot; });
    },

    /**
     * Get the textarea value
     *
     * @method getValue
     * @return {String}
     */
    getValue: function() {
        return this.state.comment;
    },

    /**
     * Emit onSubmit event with the current textarea value
     *
     * @private
     * @method _submit
     */
    _submit: function() {
        if (!this.hasComment()) {
            console.log(&quot;No comment, no submit&quot;);
            return;
        }

        this.props.onSubmit({
            comment: this.state.comment,
            clear: this.clear,
            scrollToCommentButton: this.scrollToCommentButton
        });
        this.refs.textarea.getDOMNode().focus();
    },

    _handleCommentChange: function(e) {
        this.setState({ comment: e.target.value });
    },

    getTipText: function() {
        var tip = {
            title: &quot;Yksirivitila&quot;,
            desc: &quot;Enter-näppäin lähettää kommentin. Paina Shift+enter siirtyäksesi monirivitilaan.&quot;,
            bsStyle: &quot;default&quot;
        };

        if (this.isMultilineMode()) {
            tip.title = &quot;Monirivitila&quot;;
            tip.desc = &quot;Enter-näppäin lisää rivin vaihdon. Paina Ctrl+Enter lähettääksesi kommentin.&quot;;
            tip.bsStyle = &quot;success&quot;;
        }

        return tip;
    },

    scrollToCommentButton: function() {
        if (!this.refs.commentButton) {
            console.error(&quot;Cannot scroll to comment button. Element not available!&quot;);
            return;
        }

        var $el = $(this.refs.commentButton.getDOMNode());
        if (isScrolledIntoView($el, 10)) return;
        scrollElBottom($el, 50);
    },

    render: function() {
        var self = this;
        var tip = this.getTipText();
        return (
            &lt;div className=&quot;CommentForm&quot;&gt;

                &lt;OverlayTrigger placement=&quot;left&quot; overlay={&lt;Tooltip&gt;{tip.desc}&lt;/Tooltip&gt;}&gt;
                    &lt;Label bsStyle={tip.bsStyle} className=&quot;linemode-tooltip&quot;&gt;{tip.title}&lt;/Label&gt;
                &lt;/OverlayTrigger&gt;

                &lt;ElasticTextarea
                    placeholder=&quot;Kommentti...&quot;
                    ref=&quot;textarea&quot;
                    className=&quot;form-control&quot;
                    value={this.state.comment}
                    onChange={this._handleCommentChange}
                    minRows={1}
                    onKeyDown={this._handleKeyDown}
                    onResize={function(e) {
                        if (e.active) self.scrollToCommentButton();
                    }}
                /&gt;

                &lt;div className=&quot;ticket-update-buttons&quot;&gt;
                    &lt;Button
                        ref=&quot;commentButton&quot;
                        onClick={this._submit}
                        disabled={!this.hasComment()} &gt;
                        {this.props.children}
                    &lt;/Button&gt;
                &lt;/div&gt;

            &lt;/div&gt;
        );
    },

});


module.exports = CommentForm;


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
